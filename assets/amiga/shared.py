from PIL import Image,ImageOps
import os,sys,bitplanelib,subprocess,json,pathlib

this_dir = pathlib.Path(__file__).absolute().parent

data_dir = this_dir / ".." / ".."
src_dir = this_dir / ".." / ".." / "src" / "amiga"

sheets_path = this_dir / ".." / "sheets"
dump_dir = this_dir / "dumps"

used_sprite_cluts_file = this_dir / "used_sprite_cluts.json"
used_tile_cluts_file = this_dir / "used_tile_cluts.json"
used_graphics_dir = this_dir / "used_graphics"

def palette_pad(palette,pad_nb):
    palette += (pad_nb-len(palette)) * [(0x10,0x20,0x30)]

def ensure_empty(d):
    if os.path.exists(d):
        for f in os.listdir(d):
            x = os.path.join(d,f)
            if os.path.isfile(x):
                os.remove(x)
    else:
        os.makedirs(d)

def ensure_exists(d):
    if os.path.exists(d):
        pass
    else:
        os.makedirs(d)

sr2 = lambda a,b : set(range(a,b,2))

player_sprite_pairs = (sr2(0x0,0x18) |
{0X44,0x1E,0x1B4,0x1BC,0x34,0x3A,0x32,0x36,0x3E,0x4C,0x5A,0x3C,0x1B6,0x1BE,0x4A,0x5E,0X42,0x56,0xb1,0xac,0xA4,0x11E,0xa2,0xB4,0xBE,0x11c,0x1B0,0x193,0x152,0x1A,0x8A,0x1B2,0x1c,0x14A,0x17E,0x1B8,0x1BA,0X150,0x188,0x180,0x111,
0x50,0x54,0x58,0x88,0x176,0X120,0x124,0x128,0x130,0x134,0x138,0x140,0x142,0x148,0x1F0,0x1F8,0x1FA,0x5C,0x13C,0x12C,0x18,0x195,0x10A,0x10D} |
 sr2(0X114,0x11C) | sr2(0x108,0x10C) | sr2(0Xc0,0xE0) |
sr2(0x1E0,0x1E6) | sr2(0x1E8,0x1EE) | # shoot
sr2(0x1AC,0x1B0) |
sr2(0x182,0x186) | sr2(0X18A,0x18E)
)
player_single_sprites = {0x101,
0x102,
0x10f,
0x154,
0x158,
0x159,
0x15a,
0x15b,
0x15c,
0x15d,
0x166,
0x167,
0x186,
0x187,
0x18e,
0x18f,
0x190,
0x191,
0x192,
0x197,
0x198,
0x199,
0x19a,
0x19b,
0x19c,
0x19f,
0x1a0,
0x1a1,
0x1a2,
0x1a3,
0x1a4,
0x1a5,
0x1a6,
0x1ab,
0x1ef,
0x1f3,
0x1f4,
0x81,
0x97,
0x9f,
0xa6,
0xaa,
0xab,
0xae,
0xb0,
0xb3,
0xb6,
0xb8,
0xb9,
0xba,
0xbb,
0xbd,
0xe7,
0xed,
0xee}

#0x146,0x14E use a mirror (target): don't regroup!!
group_sprite_pairs = player_sprite_pairs | {0x8E,0x85,0x17C,0xFC,0x62,0x64,0x66,0x168,0x17A,0x160,0x1A8} |sr2(0x2A,0x30)

def get_sprite_names():

    rval = dict()
    rval = {k:"player" for k in player_sprite_pairs}
    rval |= {k:"player" for k in player_single_sprites}
    rval[0x1E6] = "gun"
    rval[0x1EE] = "go"
    rval[0x16A] = "points"
    rval[0x2A] = "shadow"
    rval[0x2C] = "shadow"
    rval[0x2E] = "shadow"
    rval[0x1a8] = "weight"
    rval[0x1aa] = "weight"
    rval[0x146] = "target"
    rval[0x14e] = "target"
    rval[0x91] = "target"
    rval[0x31] = "caret"
    rval[0x6a] = "referee"
    rval[0x6b] = "referee"
    rval[0x68] = "referee"
    rval[0x69] = "referee"


    return rval

def get_mirror_sprites():
    """ return the index of the sprites that need mirroring
as opposed to Gyruss, most of the sprites don't

"""
    rval = ({0x31,0x56,0x5E,0x42,0x4A,0x1A1,0x1A3,0x1A4,0x1A5,0x1A6,0x1E6,0x1EE,0X138,0X1AC,0X110,0X130,0X124,0X12C,0X13C,
    0X134,0X113,0x103,0X107,0x1AE,0x145,0x111,0x146,0x14E,0xE1,0xE2} | sr2(0x102,0x10A)|
    sr2(0x114,0x120)  # swimmers
    )
    return rval

alphanum_tile_codes = set(range(0,10)) | set(range(65-48,65+27-48))

if __name__ == "__main__":
    raise Exception("no main!")